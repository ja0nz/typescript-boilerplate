#!/usr/bin/env sh
# Deno compile w/ preloaded import map & timestamped output

# Prelude
_required_ "deno" || exit
IMPORT_MAP=$(test -f "$ROOT/import_map.json" && echo "--import-map $_")
TSCONFIG=$(test -f "$ROOT/tsconfig.json" && echo "--config $_")

RUNFILE=$(echo $@ | grep -Po "[- \w]+\.(ts|js)" | tr \. -)
OUTPUT="$ROOT/compile/$(date +%Y-%m-%d_%H-%M-%S)_$RUNFILE"
mkdir -p "$ROOT/compile"

deno compile -o $OUTPUT $TSCONFIG $IMPORT_MAP $@
