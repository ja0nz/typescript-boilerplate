#!/usr/bin/env sh
# Deno compile w/ preloaded import map & timestamped output

# Prelude
_required_ "deno" || exit
IMPORT_MAP=$(test -f "$ROOT/import_map.json" && echo "--import-map $_")
TSCONFIG=$(test -f "$ROOT/tsconfig.json" && echo "--config $_")

RUNFILE=$(echo $@ | grep -Po "[- \w]+\.(ts|js)" | tr \. -)
TIMESTAMP=$(date +%Y-%m-%d_%H-%M-%S)
OUTPUT=$(mkdir -p "$ROOT/build/compiled/" && echo "$_""$TIMESTAMP"'_'"$RUNFILE")

deno compile -o $OUTPUT $TSCONFIG $IMPORT_MAP $@
